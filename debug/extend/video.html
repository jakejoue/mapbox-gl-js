<!DOCTYPE html>
<html>
    <head>
        <title>Mapbox GL JS debug page</title>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no"
        />
        <link rel="stylesheet" href="../../dist/mapbox-gl.css" />
        <link
            href="https://www.mapbox.com/base/latest/base.css"
            rel="stylesheet"
        />
        <style>
            body {
                margin: 0;
                padding: 0;
            }
            html,
            body,
            #map {
                height: 100%;
            }
        </style>
    </head>

    <body>
        <video id="video" src="https://static-assets.mapbox.com/mapbox-gl-js/drone.mp4" crossorigin="anonymous" style="display: none;"></video>
        <div id="map"></div>
        <div class="button pin-topleft z100" onclick="togglePlayback()">
            Play/pause
        </div>
        <div
            class="pin-bottom pad1 z100 col12 bg-white"
            style="background:white"
        >
            <input
                class="timeslider col12 fr"
                type="range"
                value="0"
                min="0"
                max="45"
                step="0.1"
                id="timeslider"
            />
        </div>
        <script src="../../dist/mapbox-gl-dev.js"></script>
        <script src="../access_token_generated.js"></script>
        <script>
            var videoStyle = {
                version: 8,
                sources: {
                    // "satellite": {
                    //     "type": "raster",
                    //     "url": "mapbox://mapbox.satellite",
                    //     "tileSize": 256
                    // },
                    tdt: {
                        type: "raster",
                        tiles: [
                            "http://t0.tianditu.com/vec_c/wmts?tk=9aebc7723eee1ef07a73f5ddfc0c1df4&SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=c&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=tiles"
                        ],
                        tileSize: 215,
                        zoomOffset: 0
                    },
                    video: {
                        type: "video",
                        video: document.getElementById('video'),
                        coordinates: [
                            [-122.51596391201019, 37.56238816766053],
                            [-122.51467645168304, 37.56410183312965],
                            [-122.51309394836426, 37.563391708549425],
                            [-122.51423120498657, 37.56161849366671]
                        ]
                    }
                },
                layers: [
                    {
                        id: "background",
                        type: "background",
                        paint: {
                            "background-color": "rgb(4,7,14)"
                        }
                    },
                    // {
                    //     id: "satellite",
                    //     type: "raster",
                    //     source: "satellite"
                    // },
                    {
                        id: "tdtlayer",
                        layout: { visibility: "visible" },
                        maxzoom: 19,
                        metadata: {
                            type: "WMTS",
                            maxExtent: "-180,-90,180,90",
                            group: "base"
                        },
                        minzoom: 1,
                        name: "vec",
                        paint: { "raster-opacity": 1 },
                        source: "tdt",
                        type: "raster"
                    },
                    {
                        id: "video",
                        type: "raster",
                        source: "video"
                    }
                ]
            };
            var map = new mapboxgl.Map({
                container: "map",
                projection: "EPSG:4326",
                minZoom: 1,
                zoom: 17,
                center: [-122.514426, 37.562984],
                bearing: -96,
                style: videoStyle,
                hash: false
            });

            document
                .getElementById("timeslider")
                .addEventListener("change", function() {
                    map.getSource("video").seek(parseFloat(this.value));
                });

            var playing = false;

            window.setInterval(function() {
                if (!playing) return;
                var time = map.getSource("video").video.currentTime;
                document.getElementById("timeslider").value = time;
            }, 500);

            function togglePlayback() {
                playing = !playing;
                if (playing) map.getSource("video").play();
                else map.getSource("video").pause();
            }
        </script>
    </body>
</html>
