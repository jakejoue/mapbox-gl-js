<!DOCTYPE html>
<html>
    <head>
        <title>Mapbox GL JS debug page</title>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no"
        />
        <link rel="stylesheet" href="../../dist/mapbox-gl.css" />
        <style>
            body {
                margin: 0;
                padding: 0;
            }
            html,
            body,
            #map {
                height: 100%;
            }
        </style>
    </head>

    <body>
        <div id="map"></div>

        <script src="../../dist/mapbox-gl-dev.js"></script>
        <script src="../access_token_generated.js"></script>
        <script>
            var stops = [
                [0, 6],
                [1, 6],
                [2, 6],
                [2.1, 3],
                [2.2, 3],
                [2.3, 3],
                [2.4, 3],
                [3, 12],
                [10, 12],
            ];

            var layer = (id, x, textSize, color) => ({
                id,
                type: "symbol",
                source: "geojson",
                filter: ["==", "x", x],
                layout: {
                    "symbol-placement": "line-center",
                    "symbol-spacing": 1,
                    "text-anchor": "left",
                    "text-allow-overlap": true,
                    "text-ignore-placement": true,
                    "icon-allow-overlap": true,
                    "icon-ignore-placement": true,
                    "text-max-angle": 180,
                    "text-field": "abcdefghijklmnopqrstuvwxyz",
                    "text-font": [
                        "Open Sans Semibold",
                        "Arial Unicode MS Bold",
                    ],
                    "text-size": textSize,
                    "icon-size": Object.assign({}, textSize, {
                        stops: textSize.stops.map((s) => [s[0], s[1] / 3]),
                    }),
                    "icon-image": "airfield-11",
                },
                paint: {
                    "text-color": color,
                    "text-opacity": 0.5,
                    "symbol-height": 1000,
                },
            });

            var style = {
                version: 8,
                metadata: {
                    test: {
                        width: 64,
                        height: 64,
                    },
                },
                sources: {
                    tdt: {
                        type: "raster",
                        tiles: [
                            "http://t0.tianditu.com/vec_c/wmts?tk=9aebc7723eee1ef07a73f5ddfc0c1df4&SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=c&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=tiles",
                        ],
                        tileSize: 256,
                        zoomOffset: 0,
                    },
                    geojson: {
                        type: "geojson",
                        lineMetrics: true,
                        data: {
                            type: "FeatureCollection",
                            features: [
                                {
                                    type: "Feature",
                                    properties: { x: 0 },
                                    geometry: {
                                        type: "LineString",
                                        coordinates: [
                                            [-10, -1],
                                            [-20, -10],
                                            [-30, -1],
                                            [-40, -10],
                                        ],
                                    },
                                },
                            ],
                        },
                    },
                },
                sprite: "mapbox://sprites/mapbox/streets-v10",
                glyphs: "mapbox://fonts/mapbox/{fontstack}/{range}.pbf",
                layers: [
                    {
                        id: "tdt",
                        type: "raster",
                        layout: { visibility: "visible" },
                        maxzoom: 19,
                        metadata: { type: "WMTS" },
                        minzoom: 1,
                        name: "vec",
                        paint: { "raster-opacity": 1 },
                        source: "tdt",
                    },

                    {
                        id: "line-base",
                        type: "line",
                        source: "geojson",
                    },

                    {
                        id: "line",
                        type: "line",
                        source: "geojson",
                        paint: {
                            "line-color": "red",
                            "line-width": 14,
                            "line-height": 500,
                        },
                        layout: {
                            "line-cap": "round",
                            "line-join": "round",
                        },
                    },

                    layer("symbol-camera", 0, { stops }, "red"),

                    layer(
                        "symbol-composite",
                        0,
                        {
                            property: "x",
                            stops: stops.map((s) => [
                                { value: 0, zoom: s[0] },
                                s[1],
                            ]),
                        },
                        "blue"
                    ),
                ],
            };

            var map = (window.map = new mapboxgl.Map({
                projection: "4326",
                container: "map",
                zoom: 4,
                center: [-20, -10],
                style,
                hash: false,
            }));

            // 添加图标点
            function addsymbol() {
                map.addSource("airport", {
                    type: "geojson",
                    data: {
                        type: "Point",
                        coordinates: [109.43367, 33.153778],
                    },
                });
                map.addSource("font", {
                    type: "geojson",
                    data: {
                        type: "Point",
                        coordinates: [115.5893, 35.659905],
                    },
                });

                var symbol = {
                    id: "airport",
                    type: "symbol",
                    source: "airport",
                    layout: {
                        "icon-image": "airfield-11",
                        "icon-size": 3,
                    },
                    paint: {
                        "symbol-height": 1000,
                    },
                };

                var symbol1 = {
                    id: "font",
                    type: "symbol",
                    source: "font",
                    layout: {
                        "text-font": [
                            "Open Sans Regular",
                            "Arial Unicode MS Regular",
                        ],
                        "text-size": 67,
                        "text-field": "你好！",
                    },
                    paint: {
                        "symbol-height": 100,
                    },
                };

                map.addLayer(symbol);
                map.addLayer(symbol1);
            }

            map.on("load", function () {
                addsymbol();
                //鼠标移动，鼠标图形改变
                map.on("mousemove", function (e) {
                    var features = map.queryRenderedFeatures(e.point);

                    map.getCanvas().style.cursor = features.length ? "pointer" : "";
                });
            });
        </script>
    </body>
</html>
